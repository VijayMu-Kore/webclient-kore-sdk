<div class="div-center">
    <div class="row header-mapping" ng-hide="component">
        <div class="col-xs-12 noPadding">
            <p class="mapping-header"></p>
        </div>
    </div>
    <div class="row mapping-step" ng-show="currentStep === 1">
        <div class="step-heading row">
            <div class="step-title"> {{'mappings_template_select_2_tasks'| i18nString}} </div>
        </div>
        <div class="row wf-form">
            <div class="row alert-action-row">
                <div class="col-md-4">
                    <div><p class="resource-when"><span class="required-field">{{'mappings_template_this_task_is_triggered'| i18nString}} </span></p></div>
                    <div class="resource-keeper">
                        <div class="no-resource text-center" ng-if="!selectedAlertStream" ng-click="toggleAlertStreamChooser()"> {{'mappings_template_click_to_select_bot'| i18nString}} </div>
                        <div ng-if="selectedAlertStream">
                            <div class="resource-left">
                                <div class="resource-img-holder">
                                    <!-- class=".app-list .list-item-details" -->
                                    <img  ng-src="{{selectedAlertStream.icon}}">
                                </div>
                            </div>
                            <div class="resource-right">
                                <div class="resource-stream">
                                    <span><strong> {{'mappings_template_bot_streamName'| i18nString:({selectedAlertStreamName:selectedAlertStream.name})}} </strong></span>
                                </div>
                                <div class="resource-name">
                                    <div ng-if="!selectedAlert" ng-click="toggleAlertResourceChooser()"> {{'click_to_slect_a_task'| i18nString}} </div>
                                    <span ng-if="selectedAlert"> {{'mappings_template_task_alertname'| i18nString:({selectedAlertName:selectedAlert.name})}} </span>
                                </div>
                            </div>
                        </div>
                        <div class="gear dropdown">
                            <span class="dropdown-toggle" id="resource-dropdown1" data-toggle="dropdown" aria-expanded="true">
                                <i class="fa fa-cog"></i>
                            </span>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="resource-dropdown1">
                                <li role="presentation" ng-click="changeStream('alert')">
                                    <a role="menuitem">{{selectedAlertStream.name?('change_bot'| i18nString):('select_bot'| i18nString)}}</a>
                                </li>
                                <li ng-if="selectedAlertStream.name" role="presentation" ng-click="changeResource('alert')">
                                    <a role="menuitem">{{selectedAlert.name?('change_task'| i18nString) :('select_task_name'| i18nString)}}</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div stream-chooser ng-if="showAlertStreamChooser" type="{{'stream'}}" sc-responder="setSelectedAlertStream({stream: stream});"></div>
                    <div stream-chooser type="{{'alert'}}" stream-id="{{selectedAlertStream._id}}" sc-responder="setSelectedAlert({alert: alert})" ng-if="showTypeaheadForAlert"></div>
                    <div ng-if="selectedAlert.name && selectedAlertStream.name">
                        <div class="alert-fields-list"  ng-show="alertFields.length>0">
                            <div class="text-center" ng-if="!noAlertFields && !alertFields"><i class="fa fa-spinner fa-spin"></i></div>
                            <div class="resource-list wrapper" ng-if="!noAlertFields">
                                <div class="resource-list-item col-xs-12" ng-repeat="_field in alertFields track by $index" draggable>
                                    {{_field}}
                                </div>
                            </div>
                        </div>
                        <div class="action-fields-list wrapper" ng-show="alertFields.length===0">
                            <div class="list-item wrapper">
                                <span class="text-center">{{'no_sample_response_for_this_task'| i18nString}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8 pull-right">
                    <div><p class="resource-when"><span class="required-field"> {{'execute_this_task'| i18nString}} </span></p></div>
                    <div class="resource-keeper">
                        <div class="no-resource text-center" ng-if="!selectedActionStream" ng-click="toggleActionStreamChooser()"> {{'mappings_template_click_to_select_bot'| i18nString}} </div>
                        <div ng-if="selectedActionStream">
                            <div class="resource-left">
                                <div class="resource-img-holder">
                                    <img ng-src="{{selectedActionStream.icon}}">
                                </div>
                            </div>
                            <div class="resource-right">
                                <div class="resource-stream">
                                    <span><strong> {{'bot_actions_streamName'| i18nString:({selectedActionStreamName:selectedActionStream.name})}} </strong></span>
                                </div>
                                <div class="resource-name">
                                    <div ng-if="!selectedAction" ng-click="toggleActionResourceChooser()"> {{'click_to_slect_a_task'| i18nString}} </div>
                                    <span ng-if="selectedAction"> {{'task_selectedActionName'| i18nString:({selectedActionName:selectedAction.name})}} </span>
                                </div>
                            </div>
                        </div>
                        <div class="gear dropdown">
                            <span class="dropdown-toggle" id="resource-dropdown2" data-toggle="dropdown" aria-expanded="true">
                                <i class="fa fa-cog"></i>
                            </span>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="resource-dropdown2">
                                <li role="presentation" ng-click="changeStream('action')">
                                    <a role="menuitem">{{selectedActionStream.name?('change_bot'| i18nString):('select_bot'| i18nString)}}</a>
                                </li>
                                <li ng-if="selectedActionStream.name" role="presentation" ng-click="changeResource('action')">
                                    <a role="menuitem">{{selectedAction.name?('change_action_task'| i18nString):('select_action_task'| i18nString)}}</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div stream-chooser ng-if="showActionStreamChooser" type="{{'stream'}}" sc-responder="setSelectedActionStream({stream: stream});"></div>
                    <div stream-chooser type="{{'action'}}" stream-id="{{selectedActionStream._id}}" sc-responder="setSelectedAction({action: action})" ng-if="showTypeaheadForAction"></div>
                    <div class="taskMapping" ng-if="selectedActionStream.name && selectedAction.name">
                        <div class="action-fields-list wrapper" ng-show="actionFields.length>0">
                            <div class="list-item wrapper" ng-repeat="_field in actionFields track by $index">
                                <div class="li-item-row row wrapper" ng-switch on="_field.fieldType">
                                    <div class="text-center" ng-if="$index === 0">
                                        <span class="li-title col-xs-2">
                                            <label>{{isAlertToDialogMapping? ('entity_caps'| i18nString) : ('field_uppercase'| i18nString)}}</label>
                                        </span>
                                        <div ng-show="!isAlertToDialogMapping" class="li-field col-xs-3 padding-0">
                                            <label>{{'label_mapping'| i18nString}}</label>
                                        </div>
                                        <div ng-class="{true:'li-field col-xs-8 padding-0 floatRight',false:'li-field col-xs-4 padding-0'}[isAlertToDialogMapping]">
                                            <label>{{'value_mapping'| i18nString}}</label>
                                        </div>
                                        <div ng-show="!isAlertToDialogMapping" class="col-xs-3">
                                            <label>{{'visibility'| i18nString}}</label>
                                        </div>
                                        <br />
                                        <hr>
                                    </div>
                                    <div ng-if="_field.showKeyTextArea" class="li-field col-xs-3 padding-0">
                                        <textarea rows="3" class="li-input-ce col-xs-12" placeholder="{{'custom_field'| i18nString}}" content-editable type="text"  ng-model="_field.title"></textarea>
                                    </div>
                                    <span ng-if="!_field.showKeyTextArea" class="li-title col-xs-2  text-center"> {{_field.title}} </span>
                                    <div ng-show="!isAlertToDialogMapping" class="li-field col-xs-3 padding-0">
                                        <textarea rows="3" class="li-input-ce col-xs-12" content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key+'label']" drop="onDrop(_field.key+'label')" ng-focus="openMappingTextAreaModalDialog(_field.title,'Label Mapping',_field.key+'label')"></textarea>
                                    </div>
                                    <div ng-if="!isAlertToDialogMapping" class="li-field col-xs-4 padding-0">
                                        <textarea rows="3" class="li-input-ce col-xs-12" contenteditable="true"   content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key]" drop="onDrop(_field.key)" ng-focus="openMappingTextAreaModalDialog(_field.title,'Value Mapping',_field.key)"></textarea>
                                    </div>
                                    <div ng-if="isAlertToDialogMapping" class="li-field col-xs-7 padding-0 floatRight">
                                        <textarea rows="3" class="li-input-ce col-xs-12" contenteditable="true"   content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key]" drop="onDrop(_field.key)" ng-focus="openMappingTextAreaModalDialog(_field.title,'Value Mapping',_field.key)" placeholder="{{_field.showKeyTextArea? ('constants.propertyPanel_contextLbl'| i18nString) :''}}"></textarea>
                                    </div>
                                    <div ng-show="!isAlertToDialogMapping" class="col-xs-3">
                                        <select ui-select2 data-placeholder="{{'select_visibility_label'| i18nString}}" ng-model="mappingObj.mapping[_field.key+'visibility']">
                                            <option></option>
                                            <option value="visible">{{'editable'| i18nString}}</option>
                                            <option value="hidden">{{'hidden'| i18nString}}</option>
                                            <option value="readonly">{{'read_only'| i18nString}}</option>
                                        </select>
                                    </div>
                                    <div class="deleteCustomMapping" ng-if="_field.showKeyTextArea && $index < actionFields.length-1"><i class="fa fa-minus-circle" aria-hidden="true" ng-click="removeDialogFlowMapping($index)"></i></div>
                                </div>
                            </div>
                        </div>
                        <div class="action-fields-list wrapper" ng-show="actionFields.length===0">
                            <div class="list-item wrapper">
                                <span class="text-center">{{'no_action_task_fields'| i18nString}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mapping-step" ng-show="currentStep === 2">
        <div class="step-heading row">
            <div class="step-title"> {{'select_Desired_bots'| i18nString}} </div>
            <!-- <div class="step-required pull-right required-field"> Required </div> -->
        </div>
        <div class="row wf-form">
            <div class="col-md-4">
                <p class="resource-when">
                    <span class="required-field"> {{'alert_task_triggered'| i18nString}} </span>
                </p>
                <div class="resource-keeper">
                    <div class="resource-left">
                        <div class="resource-img-holder">
                            <img ng-src="{{selectedAlertStream.icon}}"/>
                        </div>
                    </div>
                    <div class="resource-right">
                        <div class="resource-stream">
                            <span><strong> {{'mappings_template_bot_streamName'| i18nString:({selectedAlertStreamName:selectedAlertStream.name})}} </strong></span>
                        </div>
                        <div class="resource-name">
                            <span> {{'alert_tast_selected'| i18nString:({selectedAlertName:selectedAlert.name})}} </span>
                        </div>
                    </div>
                </div>
                <br />
                <br />
                <div class="alert-fields-list"  ng-show="alertFields.length>0">
                    <div class="text-center" ng-if="noAlertFields"> {{'no_sample_response_for_this_alert_task'| i18nString}} </div>
                    <div class="text-center" ng-if="!noAlertFields && !alertFields"><i class="fa fa-spinner fa-spin"></i></div>
                    <div class="resource-list wrapper" ng-if="!noAlertFields">
                        <div class="resource-list-item col-xs-12" ng-repeat="_field in alertFields track by $index" draggable>
                            {{_field}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8 pull-right">
                <p class="resource-when">
                    <span class="required-field"> {{'take_this_action_task'| i18nString}} </span>
                </p>
                <div class="resource-keeper">
                    <div class="resource-left">
                        <div class="resource-img-holder">
                            <img ng-src="{{selectedActionStream.icon}}"/>
                        </div>
                    </div>
                    <div class="resource-right">
                        <div class="resource-stream">
                            <span><strong>{{'bot_actions_streamName'| i18nString:({selectedActionStreamName:selectedActionStream.name})} </strong></span>
                        </div>
                        <div class="resource-name">
                            <span> {{'action_task_selectedAction'| i18nString:({selectedActionName:selectedAction.name})}} </span>
                        </div>
                    </div>
                </div>
                <br />
                <br />
                <div class="action-fields-list wrapper taskMapping" ng-show="actionFields.length>0">
                    <div class="list-item wrapper" ng-repeat="_field in actionFields track by $index">
                        <div class="li-item-row row wrapper" ng-switch on="_field.fieldType">
                            <div class="text-center" ng-if="$index === 0">
                                <span class="li-title col-xs-2">
                                            <label>{{isAlertToDialogMapping? ('entity_caps'| i18nString) : ('field_uppercase'| i18nString)}}</label>
                                </span>
                                <div ng-show="!isAlertToDialogMapping" class="li-field col-xs-3 padding-0">
                                    <label>{{'label_mapping'| i18nString}}</label>
                                </div>
                                <div ng-class="{true:'li-field col-xs-8 padding-0 floatRight',false:'li-field col-xs-4 padding-0'}[isAlertToDialogMapping]">
                                    <label>{{'value_mapping'| i18nString}}</label>
                                </div>
                                <div ng-show="!isAlertToDialogMapping" class="col-xs-3">
                                    <label>{{'visibility'| i18nString}}</label>
                                </div>
                                <br />
                                <hr>
                            </div>
                            <div ng-if="_field.showKeyTextArea" class="li-field col-xs-5 padding-0">
                                <textarea rows="3" class="li-input-ce col-xs-12" placeholder="{{'example_context'| i18nString}}" content-editable type="text"  ng-model="_field.title" context-typeahead>
                                </textarea>
                            </div>
                            <span ng-if="!_field.showKeyTextArea" class="li-title col-xs-2  text-center"> {{_field.title}} </span>
                            <div ng-show="!isAlertToDialogMapping" class="li-field col-xs-3 padding-0">
                                <textarea rows="3" class="li-input-ce col-xs-12" content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key+'label']" drop="onDrop(_field.key+'label')" ng-focus="openMappingTextAreaModalDialog(_field.title,'Label Mapping',_field.key+'label')">
                                </textarea>
                            </div>
                            <div ng-if="!isAlertToDialogMapping" class="li-field col-xs-4 padding-0">
                                <textarea rows="3" class="li-input-ce col-xs-12" contenteditable="true"   content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key]" drop="onDrop(_field.key)" ng-focus="openMappingTextAreaModalDialog(_field.title,'Value Mapping',_field.key)">
                                </textarea>
                            </div>
                            <div ng-if="isAlertToDialogMapping" class="li-field col-xs-7 padding-0 floatRight">
                                <textarea rows="3" class="li-input-ce col-xs-12" contenteditable="true"   content-editable type="text" droppable ng-model="mappingObj.mapping[_field.key]" drop="onDrop(_field.key)" ng-focus="openMappingTextAreaModalDialog(_field.title,'Value Mapping',_field.key)" placeholder="{{_field.showKeyTextArea? ('constants.propertyPanel_contextLbl'| i18nString) :''}}">
                                </textarea>
                            </div>
                            <div ng-show="!isAlertToDialogMapping" class="col-xs-3">
                                <select ui-select2 data-placeholder="{{'select_visibility_label'| i18nString}}" ng-model="mappingObj.mapping[_field.key+'visibility']">
                                    <option></option>
                                    <option value="visible">{{'editable'| i18nString}}</option>
                                    <option value="hidden">{{'hidden'| i18nString}}</option>
                                    <option value="readonly">{{'read_only'| i18nString}}</option>
                                </select>
                            </div>
                            <div class="deleteCustomMapping" ng-if="_field.showKeyTextArea && $index < actionFields.length-1"><i class="fa fa-minus-circle" aria-hidden="true" ng-click="removeDialogFlowMapping($index)"></i></div>
                        </div>
                    </div>
                </div>
                <div class="action-fields-list wrapper" ng-show="actionFields.length===0">
                    <div class="list-item wrapper">
                        <span class="text-center">{{'no_action_task_fields'| i18nString}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mapping-step" ng-show="currentStep === 3">
        <div class="step-heading row">
            <div class="step-title"> {{'give_your_mapping_a_name'| i18nString}} </div>
        </div>
        <div class="row wf-form">
            <div class="col-xs-12 form-group">
                <form name="form.mapping_form" novalidate>
                    <div class="col-xs-4 labelling">
                        <label class="required-field"> {{'mapping_name'| i18nString}} </label>
                    </div>
                    <div class="col-xs-8">
                        <input type="text" class="form-control" ng-model="mappingObj.mappingname" required placeholder="{{'enter_a_name_for_your_mapping'| i18nString}}" name="mappingname">
                        <div ng-show="form.mapping_form.mappingname.$dirty">
                            <div ng-show="form.mapping_form.mappingname.$error.required" class="text-danger form-error-text">
                                <div error-alert>
                                    {{'mapping_name_req'| i18nString}}
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="panel-body checkboxStyling">
                <div ng-if="canbeAutomated">
                    <div class="checkbox checkbox-primary">
                        <input class="styled ng-pristine ng-untouched ng-valid" checked="" type="checkbox" ng-model="mappingObj.markAsAutomated" name="markAsAutomated" id="markAsAutomated">
                        <label for="markAsAutomated">{{'allow_flow_automation'| i18nString}}</label>
                    </div>
                    <!--<div class="col-xs-12">
                        <div class="help-block col-xs-12">
                            If marked user will be able to automate this flow. This option is only available only when all the mandatory fields have been mapped.
                        </div>
                    </div>-->
                    <br>
                    <div class="col-xs-12 protipPadding"><div class="helphint-border col-xs-12 marginB20T0"><div class="col-xs-1 bulbicon"><span><img class="layer" ng-src='{{bulbIcon}}'></span></div><div class="col-xs-11"><span class="name ng-binding" ng-bind-html="$root.getSanitizedText($root.lableData.bb526)"></span></div></div></div>
                    <br>
                </div>
                <div class="checkbox checkbox-primary">
                    <input class="styled ng-pristine ng-untouched ng-valid" checked="" type="checkbox" ng-model="mappingObj.issuggestedaction" id="issuggestedaction" name="issuggestedaction">
                    <label for="issuggestedaction">{{'mark_action_as_Suggestion_Action_task'| i18nString}}</label>
                </div>
            </div>
        </div>
    </div>
    <div class="row mapping-step">
        <div class="col-xs-12">
            <div class="" ng-if="false">
                <div class="" ng-if="editMode">
                    <input class="styled ng-pristine ng-untouched ng-valid" checked="" type="checkbox" ng-model="mappingObj.issuggestedaction" id="issuggestedaction1" name="issuggestedaction">
                    <label for="issuggestedaction1">{{'mark_action_as_Suggestion_Action_task'| i18nString}}</label>
                </div>
            </div>
            <div class="col-xs-12" ng-if="editMode && !isAlertToDialogMapping">
                <div class="row">
                    <div class="col-xs-8 col-xs-offset-4">
                        <div class="panel panel-default">
                            <div class="panel-body checkboxStyling">
                                <div ng-if="canbeAutomated">
                                    <div class="checkbox checkbox-primary" ng-if="editMode">
                                        <input class="styled ng-pristine ng-untouched ng-valid" checked="" type="checkbox" ng-model="mappingObj.markAsAutomated" name=" markAsAutomated" id="markAsAutomated1">
                                        <label for="markAsAutomated1">{{'allow_flow_automation'| i18nString}}</label>
                                    </div>
                                        <!--<div class="col-xs-12">
                                        <div class="help-block col-xs-12">
                                            If marked user will be able to automate this flow. This option is only available only when all the mandatory fields have been mapped.
                                        </div>
                                    </div>-->
                                    <br>
                                    <div class="col-xs-12 protipPadding"><div class="helphint-border col-xs-12 marginB20T0"><div class="col-xs-1 bulbicon"><span><img class="layer" ng-src='{{bulbIcon}}'></span></div><div class="col-xs-11"><span class="name ng-binding" ng-bind-html="$root.getSanitizedText($root.lableData.bb526)"></span></div></div></div>
                                    <br>
                                </div>
                                <div class="checkbox checkbox-primary" ng-if="editMode">
                                    <input class="styled ng-pristine ng-untouched ng-valid" checked="" type="checkbox" ng-model="mappingObj.issuggestedaction" id="issuggestedaction1" name="issuggestedaction">
                                    <label for="issuggestedaction1">{{'mark_action_as_Suggestion_Action_task'| i18nString}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12" ng-show="component">
                <div class="form-group noMargin" ng-class="{'footer':!component}">
                    <div class="footerSub">
                        <div class="pull-right form-ctrl-div">
                            <button  ng-show="editMode" class="btn closeCancel" ng-click="saveAndExit(mapping_form.$valid,mapping_form);">
                                <span ng-show="mappingInProgress"><i class="fa fa-spinner fa-spin"></i></span>
                                &nbsp;
                                {{component? ('update'| i18nString): ('save_exit'| i18nString)}}
                                &nbsp;
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
